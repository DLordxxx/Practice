&НаКлиенте
Процедура СтудентПриИзменении(Элемент)
    Если ЗначениеЗаполнено(Объект.Студент) Тогда
        ФормаОбученияСтудента = ПолучитьФормуОбученияСтудентаНаСервере(Объект.Студент);
        Объект.ФормаОбучения = ФормаОбученияСтудента;
    Иначе
        Объект.Факультет = Неопределено;
    КонецЕсли;
КонецПроцедуры        

&НаСервере
Функция ПолучитьФормуОбученияСтудентаНаСервере(СсылкаНаСтудента)
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |	Студенты.ФормаОбучения КАК ФормаОбучения
    |ИЗ
    |	Справочник.Студенты КАК Студенты
    |ГДЕ
    |	Студенты.Ссылка = &СсылкаНаСтудента";
    
    Запрос.УстановитьПараметр("СсылкаНаСтудента", СсылкаНаСтудента);
    Результат = Запрос.Выполнить();
    Выборка = Результат.Выбрать();
    
    Если Выборка.Следующий() Тогда
        Возврат Выборка.ФормаОбучения;
    КонецЕсли;
    
    Возврат Неопределено;
КонецФункции

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	ПроверитьУникальностьФормОбученияСтудентов(Отказ, Объект.Студент, Объект.Ссылка);
КонецПроцедуры

&НаСервере
Процедура ПроверитьУникальностьФормОбученияСтудентов(Отказ, Студент, Ссылка)

    Если Не ЗначениеЗаполнено(Студент) Тогда
        Возврат;
    КонецЕсли;
    
    Отказ = Ложь;
    
    Запрос = Новый Запрос;
    Запрос.Текст =
	"ВЫБРАТЬ
    |   ФормыОбученияСтудентов.Ссылка КАК Ссылка
    |ИЗ
    |   Справочник.ФормыОбученияСтудентов КАК ФормыОбученияСтудентов
    |ГДЕ
    |   ФормыОбученияСтудентов.Студент = &Студент
    |   И ФормыОбученияСтудентов.Ссылка <> &Ссылка";  
	
	Запрос.УстановитьПараметр("Студент", Студент);
    Запрос.УстановитьПараметр("Ссылка", Ссылка);
    	
	РезультатЗапроса = Запрос.Выполнить();

    Если НЕ РезультатЗапроса.Пустой() Тогда
        Сообщить("Выбранный студент уже записан!");
        Отказ = Истина;
    КонецЕсли;

    
КонецПроцедуры

